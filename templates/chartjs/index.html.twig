{% extends 'base.html.twig' %}

{% block title %}Chiffre d'Affaires{% endblock %}

{% block body %}

<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
    .total-wrapper { background-color: #426950; padding: 20px; text-align: center; }
    .total-text { font-size: 24px; font-weight: #f5f5f5; }
</style>

{% include "header/_header.html.twig" %}

<div class="example-wrapper">
    <div class="total-wrapper">
        <p class="total-text">Somme totale : {{ resultss }} €</p>
    </div>
    <ul>
        {% for result in results %}
            <li>Date : {{ result['date_realisation']|date('Y-m-d') }}, chiffre d'affaire : {{ result['total'] }} €</li>
        {% endfor %}
    </ul>


<canvas id="chart"></canvas>
    {{ render_chart(chart, {'id': 'chart'}) }}

    <form method="get" action="{{ path('app_chiffre_affaires') }}">
        <label for="annee">Année :</label>
        <input type="text" name="annee" id="annee" placeholder="Exemple : 2023" />

        <label for="type_operation">Type d'Opération :</label>
    <select name="type_operation" id="type_operation">
        <option value="">Tous</option> <!-- Option pour afficher tous les types d'opération -->
        <option value="1">En cours</option>
        <option value="2">Fini</option>
        <!-- Ajoutez d'autres options de type d'opération au besoin -->
    </select>

  <label for="utilisateur">Utilisateur :</label>
<select name="utilisateur" id="utilisateur">
    <option value="">Tous</option> <!-- Option pour afficher toutes les utilisateurs -->
    {% for utilisateur in utilisateurs %}
        <option value="{{ utilisateur.id }}">{{ utilisateur.nom }}</option>
    {% endfor %}
</select>


        <button type="submit">Filtrer</button>
    </form>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
<script>
$(document).ready(function() {
    // Interceptez le formulaire de filtrage
    $('form').submit(function(event) {
        event.preventDefault(); // Empêche la soumission normale du formulaire
        var formData = $(this).serialize(); // Récupérez les données du formulaire
        $.ajax({
            type: 'GET',
            url: $(this).attr('action'),
            data: formData,
            success: function(data) {
                // Mettez à jour la page avec les données filtrées (par exemple, les résultats et le graphique)
                // Vous devrez implémenter cette mise à jour en fonction de votre logique spécifique.
            }
        });
    });
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
{% endblock %}
